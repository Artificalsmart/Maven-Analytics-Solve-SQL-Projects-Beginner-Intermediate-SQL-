use mavenmovies;

select s.first_name,s.last_name, s.address_id , a.address , a.district , c.city ,co.country  from staff s inner  join store st
on st.manager_staff_id = s.staff_id
inner join address a  
on s.address_id = a.address_id
inner join city c 
on a.city_id =c.city_id
inner join country  co
on c.country_id=co.country_id;


select inv.inventory_id , st.store_id , f.title , f.rating , f.rental_rate , f.replacement_cost   from inventory inv left join store st 
on  st.store_id=inv.store_id 
inner join film f
on inv.film_id = f.film_id;

select st.store_id,f.rating  ,count(inv.inventory_id) inventory_num from store st inner join inventory inv
on st.store_id =inv.store_id
left join film f 
on inv.film_id =f.film_id
group by st.store_id,f.rating  ;




select st.store_id ,c.name,
count(inv.inventory_id) as number_of_films ,
avg(f.replacement_cost) as avg_cost ,
sum(f.replacement_cost)  total_replacement_cost 
from
store st inner join 
inventory inv	
on st.store_id=inv.store_id 
left join film f 
on inv.film_id =f.film_id
left join film_category fc
on f.film_id=fc.film_id
left join category c
on fc.category_id =c.category_id
group by  st.store_id ,c.category_id
order by total_replacement_cost desc
;

select c.first_name, c.last_name ,  c.store_id ,
 c.active,
 a.address ,a.address2, cy.city , co.country  from customer c left join address a
on c.address_id =a.address_id
left join city cy
on a.city_id =cy.city_id
left join country co
on cy.country_id =co.country_id;


SELECT CONCAT(C.FIRST_NAME ," ",C.LAST_NAME) AS FULL_NAME , COUNT(P.rental_ID) AS FULL_RENTAL  , SUM(P.AMOUNT)  AS FULL_PAYMENT FROM CUSTOMER C INNER JOIN PAYMENT P
ON C.CUSTOMER_ID =P.CUSTOMER_ID
GROUP BY FULL_NAME
ORDER BY  FULL_PAYMENT DESC;


SELECT "investor" AS TYPE, I.FIRST_NAME ,I.LAST_NAME , I.COMPANY_NAME FROM INVESTOR I
UNION ALL
SELECT "ADVISOR" AS TYPE, A.FIRST_NAME ,A.LAST_NAME , null    FROM ADVISOR A;



with categorize as(
select  
sum(case when (length(awards)-length(replace(awards,",",""))+1) =3 then 1 end ) as award_per_three,
sum(case when (length(awards)-length(replace(awards,",",""))+1) =2 then 1 end ) as award_per_two,
sum(case when (length(awards)-length(replace(awards,",",""))+1) =1 then 1 end ) as award_per_one
	from actor_award
	),totals as(
    select 
    award_per_three,
    award_per_two,
    award_per_one, 
    (award_per_three+award_per_two+ award_per_one) as total_awards
    from categorize
    )
select 
round((award_per_three/total_awards)*100,2) as per_three_awards,
round((award_per_two/total_awards)*100,2) as per_two_awards,
round((award_per_one/total_awards)*100,2) as per_one_awards
 from totals
